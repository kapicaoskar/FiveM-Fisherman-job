$(document).ready(function () {
  let hitStartTime = 0;
  let maxHitTime = 2000;

  Draggable.create(".ryba", {
    type: "x,y",
    onDrag: function () {
      if (this.hitTest(".siecka") && hitStartTime == 0) {
        hitStartTime = Date.now();
        TweenLite.delayedCall(0.2, startCount);
      }
    },
  });

  function startCount() {
    if (Draggable.hitTest(".ryba", ".siecka")) {
      if (Date.now() - hitStartTime > maxHitTime) {
        $.post(`https://${GetParentResourceName()}/zamknij`, JSON.stringify({}));
        location.reload();

        $.post(`https://${GetParentResourceName()}/sukces`, JSON.stringify({}));
        hitStartTime = 0;
      } else {
        TweenLite.delayedCall(0.2, startCount);
      }
    } else {
      hitStartTime = 0;
    }
  }

  window.addEventListener("message", function (event) {
    if (event.data.action == "otworz") {
      $("body").css({ display: "block" });
    } else if (event.data.action == "zamknij") {
      $("body").css({
        display: "none",
      });
    }
    document.onkeyup = function (data) {
      if (data.which == 27) {
        location.reload();
        $.post(`https://${GetParentResourceName()}/zamknij`, JSON.stringify({}));
      }
    };
  });
});
